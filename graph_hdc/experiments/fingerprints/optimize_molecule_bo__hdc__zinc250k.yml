# PyComex configuration file for ZINC250k QED optimization using HDC with Bayesian Optimization
pycomex: true

extend: optimize_molecule_bo__hdc.py

name: optimize_bo_hdc_zinc250k_qed

description: |
  HDC-based Bayesian Optimization for molecular search on ZINC250k QED property.

  This experiment uses the ZINC250k dataset which contains ~250k drug-like molecules
  with multiple computed properties. The target property is QED (Quantitative Estimate
  of Drug-likeness) at index 1, which ranges from 0 to 1 with higher values indicating
  more drug-like molecules.

  Key features:
  - Hyperdimensional computing (HDC) representations via HyperNet encoder
  - Bayesian Optimization with Gaussian Process models from BotTorch
  - Multiple independent trials for robust performance evaluation
  - Efficient search through discrete molecular space
  - Acquisition function-guided exploration-exploitation trade-off

  QED is a composite score based on molecular properties like molecular weight,
  logP, number of hydrogen bond donors/acceptors, etc. Values close to 1.0 indicate
  highly drug-like molecules.

  Note: ZINC250k is a large dataset. We subsample to make BO tractable.

  Bayesian Optimization approach:
  1. Start with random initial samples to build GP surrogate
  2. Iteratively: Train GP -> Compute acquisition -> Select molecules -> Observe values
  3. Track best molecules found over rounds
  4. Average performance across multiple trials

parameters:
  SEED: 1
  __PREFIX__: "ex_07_c"
  __DEBUG__: false

  # Dataset configuration
  DATASET_NAME: "zinc250k"
  DATASET_NAME_ID: "zinc250k_qed_bo"
  NUM_DATA: null  # Subsample for tractable BO (full dataset is ~250k)
  NUM_HOLDOUT: 0.1  # Hold out 10% for final evaluation

  # Target property - QED (Quantitative Estimate of Drug-likeness)
  TARGET_INDEX: 1  # QED property
  TARGET_VALUE: 0.2  # Target high drug-likeness
  TARGET_MODE: "minimize_distance"  # Minimize distance to target value

  # HDC parameters
  EMBEDDING_SIZE: 64  # Moderate size for good GP performance
  NUM_LAYERS: 2
  ENCODING_MODE: "continuous"  # Better for regression and GP modeling
  DEVICE: "cpu"
  BATCH_SIZE: 500  # For HyperNet forward pass

  # Bayesian Optimization parameters
  NUM_INITIAL_SAMPLES: 10  # Random molecules to start with
  NUM_BO_ROUNDS: 25  # Number of BO iterations
  NUM_SAMPLES_PER_ROUND: 3  # Molecules to select each round
  NUM_TRIALS: 2  # Independent runs for averaging

  # Acquisition function configuration
  ACQUISITION_FUNCTION: "EI"  # Expected Improvement (or "UCB", "PI")
  UCB_BETA: 2.0  # Exploration parameter for UCB (only used if ACQUISITION_FUNCTION="UCB")

  # GP configuration
  GP_NOISE_CONSTRAINT: 0.0001  # Lower bound for observation noise
  NORMALIZE_REPRESENTATIONS: true  # Standardize features for better GP fitting
  NORMALIZE_OUTPUTS: true  # Standardize y values for better GP fitting
  USE_PCA_COMPRESSION: false  # No PCA compression (2048D is manageable)
  PCA_COMPONENTS: 50  # Only used if USE_PCA_COMPRESSION=true

  # Comparison metrics
  METRICS_THRESHOLD: 0.5  # Threshold for "rounds to threshold" metric (QED units)

  # Visualization
  PLOT_INDIVIDUAL_TRIALS: true  # Plot each trial's trajectory
  PLOT_GP_POSTERIOR: false  # Skip GP posterior plots (can be slow)
  NUM_BEST_MOLECULES_TO_SHOW: 5  # Number of best molecules to visualize

  # Note for experiment tracking
  NOTE: |
    Bayesian Optimization experiment for ZINC250k QED (drug-likeness) molecular search
    using HDC representations. Expected Improvement acquisition function with 20 initial
    samples and 25 BO rounds. Target QED of 0.9 represents highly drug-like molecules.
    Dataset subsampled to 5000 molecules for tractable optimization.

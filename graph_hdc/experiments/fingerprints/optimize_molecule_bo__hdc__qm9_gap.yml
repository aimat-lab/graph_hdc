# PyComex configuration file for QM9 GAP optimization using HDC with Bayesian Optimization
pycomex: true

extend: optimize_molecule_bo__hdc.py

name: optimize_bo_hdc_qm9_gap

description: |
  HDC-based Bayesian Optimization for molecular search on QM9 HOMO-LUMO gap.

  This experiment uses the QM9 dataset which contains quantum mechanical properties
  for ~134k small organic molecules. The target property is the HOMO-LUMO gap (index 7),
  which represents the energy difference between the highest occupied and lowest
  unoccupied molecular orbitals - a key property for electronic applications.

  Key features:
  - Hyperdimensional computing (HDC) representations via HyperNet encoder
  - Bayesian Optimization with Gaussian Process models from BotTorch
  - Multiple independent trials for robust performance evaluation
  - Efficient search through discrete molecular space
  - Acquisition function-guided exploration-exploitation trade-off

  The HOMO-LUMO gap values range from ~0.02 to ~0.62 eV (mean ~0.25 eV).
  Molecules with specific gap values are important for:
  - Organic semiconductors (small gaps)
  - Photovoltaics (medium gaps ~1.5-2.0 eV, but QM9 values are in Hartree units)
  - Wide-bandgap materials (large gaps)

  Note: QM9 is a large dataset (133k molecules). We subsample to make BO tractable.

  Bayesian Optimization approach:
  1. Start with random initial samples to build GP surrogate
  2. Iteratively: Train GP -> Compute acquisition -> Select molecules -> Observe values
  3. Track best molecules found over rounds
  4. Average performance across multiple trials

parameters:
  SEED: 3

  # Dataset configuration
  DATASET_NAME: "qm9_smiles"
  DATASET_NAME_ID: "qm9_gap_bo"
  NUM_DATA: null  # Subsample for tractable BO (full dataset is 133k)
  NUM_HOLDOUT: 0.0  # Hold out 10% for final evaluation

  # Target property - HOMO-LUMO gap (eV)
  TARGET_INDEX: 7  # GAP property
  TARGET_VALUE: 0.1  # Target gap value to search for (moderately large gap)
  TARGET_MODE: "minimize_distance"  # Minimize distance to target value

  # HDC parameters
  EMBEDDING_SIZE: 64  # Moderate size for good GP performance
  NUM_LAYERS: 2
  ENCODING_MODE: "continuous"  # Better for regression and GP modeling
  DEVICE: "cpu"
  BATCH_SIZE: 500  # For HyperNet forward pass

  # Bayesian Optimization parameters
  NUM_INITIAL_SAMPLES: 10  # Random molecules to start with
  NUM_BO_ROUNDS: 25  # Number of BO iterations
  NUM_SAMPLES_PER_ROUND: 2  # Molecules to select each round
  NUM_TRIALS: 10  # Independent runs for averaging

  # Acquisition function configuration
  ACQUISITION_FUNCTION: "EI"  # Expected Improvement (or "UCB", "PI")
  UCB_BETA: 2.0  # Exploration parameter for UCB (only used if ACQUISITION_FUNCTION="UCB")

  # GP configuration
  GP_NOISE_CONSTRAINT: 0.0001  # Lower bound for observation noise
  NORMALIZE_REPRESENTATIONS: true  # Standardize features for better GP fitting
  USE_PCA_COMPRESSION: false  # No PCA compression (2048D is manageable)
  PCA_COMPONENTS: 50  # Only used if USE_PCA_COMPRESSION=true

  # Comparison metrics
  METRICS_THRESHOLD: 0.05  # Threshold for "rounds to threshold" metric (eV)

  # Visualization
  PLOT_INDIVIDUAL_TRIALS: true  # Plot each trial's trajectory
  PLOT_GP_POSTERIOR: false  # Skip GP posterior plots (can be slow)
  NUM_BEST_MOLECULES_TO_SHOW: 5  # Number of best molecules to visualize

  # Note for experiment tracking
  NOTE: |
    Bayesian Optimization experiment for QM9 HOMO-LUMO gap molecular search using HDC
    representations. Expected Improvement acquisition function with 20 initial samples
    and 25 BO rounds. Target gap of 0.4 eV represents a moderately large bandgap molecule.
    Dataset subsampled to 5000 molecules for tractable optimization.
